# Contexte

## Les données d'enquête

- Base "historique" privilégiée des statistiques
- Présentent de nombreux avantages : finalité est la bonne, cadre et concept maîtrisé
- Mais ce sont des données longues à récolter et coûteuses pour le répondant et l'Insee (plusieurs années)
- Dans un contexte de demande de statistiques plus poussées avec des moyens stables

## En parallèle, prolifération des données

- Numérisation et innovations technologiques ont réduit le coût de production de la donnée
    + Volume de données produites en explosion

. . .

- L'utilisation des statistiques n'est pas nouvelle (cf. [Desrosières](https://www.cairn.info/la-politique-des-grands-nombres--9782707165046.htm))...

. . .

- ... mais une place accrue :
    + Dans le débat public et l'action publique ([Supiot](https://www.fayard.fr/sciences-humaines/la-gouvernance-par-les-nombres-9782213681092), [Martin](https://www.cairn.info/l-empire-des-chiffres--9782200625719.htm))
    + Dans les stratégies d'entreprise

## Diversification des données {.smaller}

- Des données de nature très différentes :
    - Données structurées classiques
    - Données géolocalisées
    - Données textuelles et non structurées
    - Images, sons et vidéos

. . .

- Besoin de nouvelles méthodes pour valoriser ces données :
    - _Machine learning_ (re)devenu un outil classique
    - Réseaux de neurone pour les problèmes complexes (NLP, CV)...

::: {.callout-tip}
## Pourquoi le _machine learning_ ?

- Meilleure prise en compte des non-linéarités que la statistique paramétrique
- Simplicité pour la mise en oeuvre opérationnelle
- ...
:::

## Diversification des données (1/4)

### Données administratives

- __Enregistrements automatisés__ de systèmes de gestion
- Données __structurées__ sous forme de tableau

![Source : [Hadley Wickham, _R for data science_](https://r4ds.hadley.nz/data-tidy.html)](https://r4ds.hadley.nz/images/tidy-1.png)


## Diversification des données (1/4)

### Données administratives

```{ojs}
viewof info_mutations = Inputs.radio(
  ["Tableau", "Graphique"], {value: "Tableau"}
)
```

```{ojs}
info_mutations == "Tableau" ? html`<div>${table_mutations1}<div>` : html`<div>${plot_mutations}<div>`
```

```{ojs}
//| echo: false
// data coming from "https://files.data.gouv.fr/geo-dvf/latest/csv/2020/communes/92/92049.csv"
// fetched manually because of CORS issue
url = "https://minio.lab.sspcloud.fr/nicolastlm/diffusion/92049.csv"
dvf = d3.csv(url)
```

```{ojs}
//| output: false
table_mutations1 = Inputs.table(dvf, {"columns": ['date_mutation', 'valeur_fonciere', 'adresse_nom_voie']})
plot_mutations = Plot.plot({
  y: {grid: true, label: "Nombre de transactions"},
  x: {
    ticks: 12,
    transform: (d) => Math.pow(10, d),
    type: "log",
    tickFormat: "~s",
    label: "Prix (échelle log) →"
  },
  marks: [
    Plot.rectY(
      dvf.filter(d => d.valeur_fonciere > 10000),
      Plot.binX({y: "count"},
      {
        x: d => Math.log10(d.valeur_fonciere),
        tip: true
      })
    ),
    Plot.ruleY([0])
  ]
})
```

```{ojs}
Plot = require("https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6.10/dist/plot.umd.min.js")
```

_Exemple_ : les données DVF

## Diversification des données (2/4)

<h3>Données géolocalisées</h3>

```{ojs}
viewof info_power_plants = Inputs.radio(
  ["Tableau", "Carte"], {value: "Tableau"}
)
```

```{ojs}
info_power_plants == "Tableau" ? html`<div>${table_power_plants}<div>` : html`<div>${plot_power_plants}<div>`
```

```{ojs}
//| output: false
import {us_power_plants, states} from "@observablehq/build-your-first-map-with-observable-plot"

table_power_plants = Inputs.table(
  us_power_plants
)

plot_power_plants = Plot.plot({
  projection: "albers-usa",
  marks: [
    Plot.geo(states, { fill: "white", stroke: "#e2e2e2"  }),
    Plot.dot(us_power_plants, {
      x: "longitude",
      y: "latitude",
      r: "Total_MW",
      fill: "PrimSource",
      opacity: 0.7,
      tip: true
    }),
    Plot.dot(us_power_plants, { // Can you figure out what this additional Plot.dot layer adds?
      x: "longitude",
      y: "latitude",
      r: "Total_MW",
      fill: "PrimSource",
      stroke: "black",
      filter: d => d.Total_MW > 3500,
    }),
    Plot.text(us_power_plants, { // Add text to the map using data from us_power_plants
      x: "longitude", // Place text horizontally at plant longitude
      y: "latitude", // Place text vertically at plant latitude
      text: "Plant_Name", // The text that appears is the value from the Plant_Name column,
      filter: (d) => d.Total_MW > 3500, // Only add text for plants with capacity exceeding 3500 MW
      fontSize: 12, // Increased font size
      fontWeight: 600, // Increased font weight
      stroke: "white", // Adds white outer stroke to text (for readability)
      fill: "black", // Text fill color
      textAnchor: "start", // Left align text with the x- and y-coordinates
      dx: 15 // Shifts text to the right (starting from left alignment with coordinate)
    })
  ],
  r: { range: [1, 15] },
  color: { legend: true },
  height: 500,
  width: 800,
  margin: 50
})
```

## Diversification des données (2/4)

<h3>Données géolocalisées</h3>

- Données tabulaires avec une dimension spatiale supplémentaire
- Dimension géographique prend des formes multiples :
    + Points, lignes, polygones...

. . .

- {{< fa brands python >}} et {{< fa brands r-project >}} très bien outillés pour ces données

## Diversification des données (3/4) {.smaller}

<h3>Données textuelles et non structurées</h3>

- Techniques statistiques anciennes ([Levenshtein 1957](https://en.wikipedia.org/wiki/Levenshtein_distance), [perceptron](https://fr.wikipedia.org/wiki/Perceptron))

. . .

- Applications limitées jusqu'aux années 2010

. . .

- Développement très rapide de la recherche :
    + Collecte accrue : réseaux sociaux, enquêtes, _webscraping_...
    + Baisse coûts stockage & augmentation ressources traitement
    + Nouvelles techniques statistiques : LLM...

. . .

- Utilisation intensive dans l'administration, la recherche et le secteur privé

## Diversification des données (3/4) {.smaller}

<h3>Données textuelles et non structurées</h3>

- Les __[LLM]{.blue2}__ bien sûr...
- ... Mais pas que !

<br>

- Classification automatique de l'activité principale d'une entreprise :

```{ojs}
async function transformToPost(description) {
  // Base URL with query parameters
  const baseUrl = `https://codification-ape2025-pytorch.lab.sspcloud.fr/predict/?nb_echos_max=5&prob_min=0.01&num_workers=0&batch_size=1`;

  // Build the request body according to the expected schema
  const body = {
    forms: [
      {
        description_activity: description
      }
    ]
  };

  // Send the POST request
  const response = await fetch(baseUrl, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(body)
  });

  // Parse and return the JSON response
  return response.json();
}
```


```{ojs}
viewof activite = Inputs.text({
  label: '',
  value: 'ma société fera du conseil en traitement de données',
  width: 800
})

viewof prediction = Inputs.button("Run Prediction", {
  reduce: async () => {
    return await transformToPost(activite);
  }
})

// afficher les résultats joliment
prediction_table = {
  if (!prediction || !prediction.length) {
    return html``
  }

  // la réponse est un tableau avec un seul objet
  const result = prediction[0]
  const { IC, MLversion, ...codes } = result

  const rows = Object.values(codes).map(({ code, libelle, probabilite }) => {
    return html`
      <tr>
        <td>${code} – ${libelle}</td>
        <td style="text-align:right;">${probabilite.toFixed(3)}</td>
      </tr>
    `
  })

  return html`
    <table style="border-collapse: collapse; width: 100%;">
      <caption style="margin-bottom: 0.5em;">
        Confidence score : ${(+IC).toFixed(3)}
      </caption>
      <thead>
        <tr>
          <th style="text-align:left;">Description (NA2008)</th>
          <th style="text-align:right;">Probability</th>
        </tr>
      </thead>
      <tbody>
        ${rows}
      </tbody>
    </table>
  `
}
```

## Diversification des données (4/4)

### Images, sons et vidéos

![](https://nanonets.com/blog/content/images/2020/08/1_Hz6t-tokG1niaUfmcysusw.jpeg)
